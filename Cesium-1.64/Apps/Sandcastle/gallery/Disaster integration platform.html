<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">
    <meta name="description" content="Use Viewer to start building new applications or easily embed Cesium into existing applications.">
    <meta name="cesium-sandcastle-labels" content="Beginner, Showcases">
    <title>Cesium Demo</title>
    <script type="text/javascript" src="../Sandcastle-header.js"></script>
    <script type="text/javascript" src="../../../Build/CesiumUnminified/Cesium.js" nomodule></script>
    <script type="module" src="../load-cesium-es6.js"></script>
</head>
<body class="sandcastle-loading" data-sandcastle-bucket="bucket-requirejs.html">
<script src="http://code.jquery.com/jquery-3.4.1.min.js"></script>
<script src="http://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>   

    <style>
    @import url(../templates/bucket.css);
</style>
<div id="cesiumContainer" class="fullSize"></div>
<div id="loadingOverlay"><h1>Loading...</h1></div>
<div id="toolbar"></div>
<script id="cesium_sandcastle_script">
function startup(Cesium) {
    'use strict';
//Sandcastle_Begin
//////////////////////////////////////////////
//initial the cesium platform
//////////////////////////////////////////////

    var viewer = new Cesium.Viewer('cesiumContainer');
    viewer.scene.globe.enableLighting = false;
    // set the cesium token and map token
    Cesium.Ion.defaultAccessToken = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiIwZTdlNGQxNy03MjJjLTQ2ZjItYjc3MC0zZmMzOWRkZTZkNDYiLCJpZCI6MzczMSwic2NvcGVzIjpbImFzciIsImdjIl0sImlhdCI6MTUzODY1MjA0OH0.cy2FnkM4c7dUFQJrrAtKOQtJyFuN1UrLMiBAwUjbs0k';
    Cesium.BingMapsApi.defaultAccessTokenKey ='AtnrXO-GaWfQWtvkf7fq4WHB0bQ7ncFVvLmVS5oAytmnTEVfFnzzTulmkjpqFV3N';

    // set the initial position in taiwan
    var initialPosition = new Cesium.Cartesian3.fromDegrees(120.26115, 23.006,  1000000);
    var initialOrientation = new Cesium.HeadingPitchRoll.fromDegrees(0, -90, 0);
    var homeCameraView = 
    {
         destination : initialPosition,
         orientation : 
         {
         heading : initialOrientation.heading,
         pitch : initialOrientation.pitch,
         roll : initialOrientation.roll
         }
    };

    // Set the initial view
     viewer.scene.camera.setView(homeCameraView);

    // Add some camera flight animation options
     homeCameraView.duration = 2.0;
     homeCameraView.maximumHeight = 2000;
     homeCameraView.pitchAdjustHeight = 2000;
     homeCameraView.endTransform = Cesium.Matrix4.IDENTITY;
    // // Override the default home button
     viewer.homeButton.viewModel.command.beforeExecute.addEventListener(function (e) {
         e.cancel = true;
         viewer.scene.camera.flyTo(homeCameraView);
         viewer.entities.removeAll();
     });


////////////////////////////////////////////////
//3d models in map
////////////////////////////////////////////////	 

    // create model function	 
    function createModel(url,degrees1,degrees2,height,heading,pitching,roll,scale) {
       viewer.entities.removeAll();
       var position = Cesium.Cartesian3.fromDegrees(degrees1, degrees2, height);
       var hpr = new Cesium.HeadingPitchRoll(heading,pitching,roll);
       var modelMatrix=Cesium.Transforms.headingPitchRollToFixedFrame(position,hpr);
       var model = viewer.scene.primitives.add(Cesium.Model.fromGltf(
       {
           url : url,
           modelMatrix : modelMatrix,
           scale :scale,
           castShadows: false,
           receiveShadows: false,
       }));
    } 

    //add hosipital entity
    function createHospital(hpname,hpposition,data1,data2,data3){
       var pinBuilder = new Cesium.PinBuilder();
       var color ;
        if (data3>80){
            color = Cesium.Color.RED;
        }else if(data3>50){
            color = Cesium.Color.YELLOW;
        }else{color = Cesium.Color.GREEN;}
       viewer.entities.add({        
           name: hpname,
           position: hpposition,
           description:'<table border="1"><tr><td>急性保險病床數</td><td>'+data1+'</td></tr><tr><td>急性病床數</td><td>'+data2+'</td></tr><tr><td>急性保險病床比率</td><td>'+data3+'%'+'</td></tr></table>',
           billboard:
           {
               color : color,
               image:'../Source/Images/hospital/yellostar.png',
               scale : 0.2,
               verticalOrigin : Cesium.VerticalOrigin.BOTTOM

           }
      });
    }

    //add building information

    var iframe = document.getElementsByClassName('cesium-infoBox-iframe')[0];
    iframe.setAttribute('sandbox', 'allow-same-origin allow-scripts allow-popups allow-forms'); 
    var pinBuilder = new Cesium.PinBuilder();



//////////////////////////////////////
//hosipital information
//////////////////////////////////////

//hp1=醫療中心等級醫院
    const hp1name = [   //0            1          2         3           4
                        "台大醫院","台大兒醫","三軍總醫院","臺北榮總","國泰醫院",
                        //5            6          7         8         9
                        "馬偕台北","馬偕兒醫","新光醫院","亞東醫院","馬偕淡水",
                        //10                  11           12          13         14
                        "萬芳醫院(台北)","台北長庚醫院","林口長庚醫院","台中榮總","中國兒醫",
                        //15           16     17       18        19
                        "中山醫院","中國附醫","彰基","彰基兒醫","成大醫院",
                        //20                     21                22          23            24
                        "奇美醫院(台南南區)","奇美醫院(台南永康)","高雄榮總","高雄長庚醫院","高醫大附醫",
                        //25
                        "慈濟醫院(花蓮)"

                    ];
    const hp1position = [];
    hp1position[0] = new Cesium.Cartesian3.fromDegrees(121.518969,25.040678,0);
    hp1position[1] = new Cesium.Cartesian3.fromDegrees(121.518703,25.044171,0);
    hp1position[2] = new Cesium.Cartesian3.fromDegrees(121.592263,25.071708,0);
    hp1position[3] = new Cesium.Cartesian3.fromDegrees(121.520134,25.120336,0);
    hp1position[4] = new Cesium.Cartesian3.fromDegrees(121.553638,25.036883,0); 
    hp1position[5] = new Cesium.Cartesian3.fromDegrees(121.522216,25.058677,0); 
    hp1position[6] = new Cesium.Cartesian3.fromDegrees(120.988108,24.778289,0);
    hp1position[7] = new Cesium.Cartesian3.fromDegrees(121.520155,25.096404,0);
    hp1position[8] = new Cesium.Cartesian3.fromDegrees(121.452663,24.996988,0);
    hp1position[9] = new Cesium.Cartesian3.fromDegrees(121.461892,25.138886,0);
    hp1position[10] = new Cesium.Cartesian3.fromDegrees(121.558140,24.999901,0);
    hp1position[11] = new Cesium.Cartesian3.fromDegrees(121.549625,25.055415,0);
    hp1position[12] = new Cesium.Cartesian3.fromDegrees(121.367572,25.061085,0);
    hp1position[13] = new Cesium.Cartesian3.fromDegrees(120.604603,24.184795,0);
    hp1position[14] = new Cesium.Cartesian3.fromDegrees(120.988108,24.778289,0);
    hp1position[15] = new Cesium.Cartesian3.fromDegrees(121.549910,25.036681,0);
    hp1position[16] = new Cesium.Cartesian3.fromDegrees(120.680514,24.157747,0);
    hp1position[17] = new Cesium.Cartesian3.fromDegrees(120.544682,24.071142,0);
    hp1position[18] = new Cesium.Cartesian3.fromDegrees(120.543507,24.071160,0);
    hp1position[19] = new Cesium.Cartesian3.fromDegrees(120.219567,23.001965,0);
    hp1position[20] = new Cesium.Cartesian3.fromDegrees(120.221937,23.020777,0);
    hp1position[21] = new Cesium.Cartesian3.fromDegrees(120.221837,23.020756,0);
    hp1position[22] = new Cesium.Cartesian3.fromDegrees(120.322504,22.677537,0);
    hp1position[23] = new Cesium.Cartesian3.fromDegrees(120.356838,22.650063,0);
    hp1position[24] = new Cesium.Cartesian3.fromDegrees(120.309777,22.647373,0);
    hp1position[25] = new Cesium.Cartesian3.fromDegrees(121.592515,23.995097,0);




////////////////////////////////////////////
//tool bar manu
///////////////////////////////////////////
    function add_gym(){
        createModel('../Source/SampleData/Models/test1/scene.gltf',120.208000,23.032460,0,0,1.5,0,0.5 );
        
        var planPin = viewer.entities.add(
        {
            name:"活動中心全景圖",
            description: '<iframe src="https://www.360cities.net/embed_iframe/panorama_tmp-8049" width="500" height="400" frameborder="0" bgcolor="#000000" target="_blank" allowfullscreen webkitallowfullscreen mozallowfullscreen></iframe><br/><a title="Panorama photos of 安西里活動中心 on 360cities.net" href="https://www.360cities.net/image/panorama_tmp-8049">安西里活動中心</a>',
            position : Cesium.Cartesian3.fromDegrees(120.20800,23.032478,10),
            billboard : 
            {
                image : pinBuilder.fromColor(Cesium.Color.ROYALBLUE, 48).toDataURL(),
                verticalOrigin : Cesium.VerticalOrigin.BOTTOM
            }
         });
         
        var planPin2 = viewer.entities.add(
        {
            name:"活動中心直播影片",
            description:'<iframe width="500" height="400" src="https://www.youtube.com/embed/Bs1ZcKhnxSo" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>',
            position: Cesium.Cartesian3.fromDegrees(120.20800,23.032500,10),
            billboard:
            {
                image : pinBuilder.fromColor(Cesium.Color.LIME, 48).toDataURL(),
                verticalOrigin : Cesium.VerticalOrigin.BOTTOM
            }          
        });
        viewer.camera.flyTo({
            destination : Cesium.Cartesian3.fromDegrees(120.208000,23.032460,100)
        });
    }
    
    
    function add_japanbuilding(){
        createModel('../Source/SampleData/Models/shanghai_city_scene/scene.gltf',120.261150,23.006000,0,0,0,0,0.1 );  
        viewer.camera.flyTo({
            destination : Cesium.Cartesian3.fromDegrees(120.261150,23.006000,200)
        });
    }
    Sandcastle.addToolbarMenu([
        {
            text : 'Model',
            onselect : function() {
            viewer.entities.removeAll();
            }
        },
        {
        text : 'gym',
        onselect : function() {
            add_gym();
            Sandcastle.highlight(add_gym);
        }},
        {
        text : 'Japanbuilding',
        onselect : function() {
            add_japanbuilding();
            Sandcastle.highlight(add_japanbuilding);
        }}
    ]);

    Sandcastle.addToolbarMenu([
        {
            text : 'toolbox',
            onselect : function() {
            viewer.entities.removeAll();
            }
        },
        {
            text : 'ajaxButton',
            onselect : function(){
            var httpRequest;
                httpRequest = new XMLHttpRequest();
                if (!httpRequest) 
                {
                    alert('Giving up :( Cannot create an XMLHTTP instance');
                    return false;
                }
                httpRequest.onreadystatechange = alertContents;
                httpRequest.open('GET', '../Source/hospital.json');
                httpRequest.send();
            
            function alertContents() 
               {
                if (httpRequest.readyState === XMLHttpRequest.DONE) 
                    {
                    if (httpRequest.status === 200) 
                        {
                            alert(httpRequest.responseText);
                        } else {alert('There was a problem with the request.');}
                    }
                }
            }      
            
        },
        {
            text : 'live streaming',
            onselect : function(){
            window.open("https://www.youtube.com/embed/Bs1ZcKhnxSo");
            }
        },
        {
            text : 'eoc',
            onselect : function(){
            window.open("https://www.nhi.gov.tw/SysService/SevereAcuteHospital.aspx?menu=18&menu_id=683&WD_ID=1119");
            }
        },
        {
            text : 'hospital',
            onselect : function(){
                           for(var i=0; i<26; i++){
                               createHospital(hp1name[i], hp1position[i], parseInt(Math.random()*1000), parseInt(Math.random()*1000), parseInt(Math.random()*100));
    
                           }
                       }
        }
    ]);




//Sandcastle_End
    Sandcastle.finishedLoading();
}
if (typeof Cesium !== 'undefined') {
    window.startupCalled = true;
    startup(Cesium);
}
</script>
</body>
</html>
